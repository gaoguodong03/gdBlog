---
title: 多智能体协同架构调研
date: 2025-10-11
tags:
  - LLM
  - Agent
  - 调研
categories: 果冻的理论学习
cover: ./img/logoZiyouzhiyi.jpg
---


上下文工程

任务管理者 依次往总线扔任务

# 会议时间
文档链接：https://free4inno.feishu.cn/wiki/CxV0wuVATi8Z0hk6wF8cWgzCnTb
报告时间：2025/10/10
报告人：孟千斌

## 简要记录
调研了多种多智能体协同架构，包括 OpenManus、微软开源的 AutoGen、字节开源的 LongManus（基于 LongGraph）等，并对它们进行了横向对比
- **OpenManus**：因闭源，分析基于官网 Blog 及演示视频，聚焦其多智能体协同模式，单智能体模式未涉及。
- **AutoGen**：提供 5 种多智能体协同解法：
    - **双智能体聊天（带函数调用）**：由用户代理和助手构成，通过交替对话、任务拆分函数调用逐步完成任务，支持人工在关键节点介入。
    - **群聊（Group chat）**：预设多角色智能体与群聊管理器，管理器根据上下文和角色能力自动路由任务，公共历史记录信息，支持发布 / 订阅模式优化。
    - **AutoBuild**：能从自然语言需求出发，自动生成带角色定位的智能体并组成群聊，经协作完成任务后反思总结并返回结果。
    - **Mixture of Agents**：模仿前馈神经网络架构，含协调者和执行代理，协调者分派任务、聚合结果，执行代理分层处理任务。
    - **Multi-Agent Debate**：由汇聚者和解题代理组成，汇聚者广播任务并整合结果，解题代理独立求解并多轮交换调整答案，最终收敛到一致结果。
- **LongManus**：采用分层多智能体架构，上层 “主管 / 协调者” 负责流程编排与质控，底层 “专家代理” 执行具体任务。

当前，元芳采用的模式，类似于Group Chat的发布/订阅（pub-sub）模式，设定一个任务管理者，依次往总线读取任务

# LongGraph给出的几类多智能体协同模式

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=MDE2ZWE3ZTQzOGQwMTVkNDRlZmM5MWE1MjYwNjI5MDNfVTNGMWNCajVuSlRPek1aSE5LdWVHNjhISkJvdDJnd1NfVG9rZW46WlRMWGIwb202b2pmOVp4b24yUGNNSmlTbmx4XzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)

  

# 1.OpenManus

由于Manus闭源，现有的技术分析都是基于其官网Blog以及演示视频进行的分析，这里首先选择最简单的Openmanus进行多智能体协同框架的调研。OpenManus内部处理任务时分为两个模式，其中单智能体模式不在本次调研范围内故忽略，下面开始介绍其中的多智能体协同模式。

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=OWU4ZGZiNDkzYTAwN2Q3NjI4NzEzZDAyNDFhMjk1YWRfM3NMUEhpRHA0eTlSc2hhSExhQVFtSWx4R3hrZ2FIYWdfVG9rZW46S2FhcWJUNzFsb3hROE54VlhvMmM4bHl4blRiXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)

  

# 2.AutoGen

AutoGen 是微软的一个开源编程框架，用于构建 AI 代理并促进多个智能体之间的合作解决任务，其中关于多智能体协同给出了5种不同的有效解法。

> https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html

## 2.1 Two-agent chat with function call for task decomposition

设置用户代理（代替用户来提出问题，在关键节点人工介入）以及助手（执行任务），在交替对话中逐步得出任务结果。在接收到用户输入之后由助手判断任务需要拆分，并建议调用任务拆分函数，由用户代理执行函数，函数内由planner_user发起与planner的对话，形成双智能体对聊。

```Python
assistant = AssistantAgent(
    name="assistant",
    system_message="You are a helpful AI assistant. "
    "You can use the task planner to decompose a complex task into sub-tasks. "
    "Make sure your follow through the sub-tasks. "
    "When needed, write Python code in markdown blocks, and I will execute them."
    "Give the user a final solution at the end. "
    "Return TERMINATE only if the sub-tasks are completed.",
    llm_config={
        "config_list": config_list,
        "cache_seed": None,  # Disable legacy cache.
    },
)

user_proxy = UserProxyAgent(
    name="user_proxy",
    human_input_mode="ALWAYS",
    is_termination_msg=lambda x: "content" in x
    and x["content"] is not None
    and x["content"].rstrip().endswith("TERMINATE"),
    code_execution_config={"executor": code_executor},
)
```

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=NDc1OTk2NmFiYmIyNDI4ZWM4NjgwYjVmMWI1ZjQ3YzlfcGRTTjZONXBtcWRZcnFWR2hiUkd5ZEVmdFdjRnE1VEtfVG9rZW46RG1BNGJWS0JCb1lkOVB4RnZXR2N2SEQ2bkpkXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)

以撰写一篇关于英伟达过去一个月股价表现的博客文章为例。

识别到用户输入以后由用户代理向助手提出任务，助手判断需要任务拆分以后调用拆分函数，第一层任务拆分由Planner返回给用户代理，如下：

1. 研究：近一月 NVDA 股价数据或新闻/新闻稿/财报或宏观与行业因素；
    
2. 分析：识别价格模式与事件关联，准备图表；
    
3. 大纲：引言/背景/月度表现/影响因素/结论；
    
4. 写作：按大纲撰写正文并嵌入可视化；
    
5. 编辑发布：校对、SEO、发布与分发、合规声明。
    

得到第一层任务规划之后，用户代理继续将其返回给助手，助手针对第一项任务“研究”拆分出可执行的第二层子任务计划：

1. 确定数据源（网站或 API）
    
2. 数据下载/抓取
    
3. 解析与清洗
    
4. 基础分析和可视化
    

拆分后助手将其返回给用户代理，用户代理确认无误后进入执行：用户代理将任务顺序交付给助手，助手返回可执行代码，用户代理确认无误后执行代码并返回运行结果，助手总结执行结果后给出下一步建议（可以写作了），用户代理发令（写博客正文）后由助手产出文章。

其中的Human-in-the-Loop（HITL）：每次对话返回到用户代理时可选择人工介入输入自然语言要求或者由用户代理AutoReply。且在配置Agent时，用户代理可设置是否在关键节点暂停等待人工介入（Always、Terminal、Never）

## 2.2 Group chat

GroupChat 将“任务分解—执行分发—结果收敛”封装为一个由预设多角色agent与统一路由器协同运转的会话式流程。大致流程就是在群聊中事先定义角色：Admin（用户代理）、Planner（规划）、Engineer（生成可执行代码）、Executor（执行器）、Writer（撰写/润色）、GroupChatManager（群聊管理器/路由）。管理器根据最近消息与角色设定自动选下一发言者，或采用自定义发言顺序实现确定性流程。

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=MGJhODNjNTVjYmJmNmY1ZGQwMzJkODEwMTllYzY5NGVfMER4cm9FWmdHWUFzNXBCVlZ2clNjbTlqRnB1NVpnVVRfVG9rZW46R3VGRmJnUGJqb2dBUmJ4RWp5M2NlOGdObldkXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)

  

```Python
planner = AssistantAgent(
    name="Planner",
    system_message="""Planner. Given a task, please determine what information is needed to complete the task.
Please note that the information will all be retrieved using Python code. Please only suggest information that can be retrieved using Python code.
""",
    llm_config={"config_list": config_list, "cache_seed": None},
)

engineer = AssistantAgent(
    name="Engineer",
    llm_config={"config_list": config_list, "cache_seed": None},
    system_message="""Engineer. You write python/bash to retrieve relevant information. Wrap the code in a code block that specifies the script type. The user can't modify your code. So do not suggest incomplete code which requires others to modify. Don't use a code block if it's not intended to be executed by the executor.
Don't include multiple code blocks in one response. Do not ask others to copy and paste the result. Check the execution result returned by the executor.
If the result indicates there is an error, fix the error and output the code again. Suggest the full code instead of partial code or code changes. If the error can't be fixed or if the task is not solved even after the code is executed successfully, analyze the problem, revisit your assumption, collect additional info you need, and think of a different approach to try.
""",
)

writer = AssistantAgent(
    name="Writer",
    llm_config={"config_list": config_list, "cache_seed": None},
    system_message="""Writer. Please write blogs in markdown format (with relevant titles) and put the content in pseudo ```md``` code block. You will write it for a task based on previous chat history. Don't write any code.""",
)
```

  

```Plain
groupchat = GroupChat(
    agents=[user_proxy, engineer, code_executor, writer, planner],
    messages=[],
    max_round=20,
    speaker_selection_method="auto",
)
```

### **协作流程**

首先，用户或外部代理将消息发布到所有参与者的群聊，GroupChatManager 读取后结合各agent的角色定义与系统提示，对需求进行语义理解并选择合适的首发角色（常见为 Planner）。

Planner 基于目标、约束与可用工具提出顶层工作计划，把任务拆为若干可验证的子目标，在措辞中指派子任务类型（如数据获取、算法实现、撰写与审校），并发布到公共群聊，由此完成第一次“对话式”任务分解。

随后，Manager 在每一回合据最近上下文与角色能力进行自动路由，按任务类型分配对应的执行Agent：工程类子目标会被分配给 Engineer 产出可执行方案与外部工具调用；一旦出现可执行代码或工具请求，执行代理就会接棒运行并将运行日志与观测结果写回公共历史；需要文本合成与结构化表达的阶段，则让 Writer 将数据与洞见组织为成稿；若计划存在遗漏或证据链不足，Manager 会再次调度 Planner 或相关agent在对话中“二次拆分”，补充数据源、指标口径、对照实验或质量门槛，形成局部迭代的二次计划。

整个过程中，公共历史承担记忆与审计作用，所有代理都基于同一上下文生成回复，路由策略既可采用内置的“auto”语义选择器以动态适应复杂情境，也可配置成固定顺序以获得确定性时延和成本；当消息中出现显式终止信号或满足预设完成条件时，Manager 结束对话并输出汇总结果。

在AutoGen0.7.5中，群聊被优化为发布/订阅（pub-sub）的方式，每个智能体有自己的**私有主题**，群聊有一个**公共主题**，是否订阅主题成为谁能收到该主题信息的关键。

## 2.3 AutoBuild

AutoBild实现了从自然语言需求输入，经由自动任务分割与多专家分工协作，到最终交付总结性回答的完整闭环流程。

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=YzgzZDNiNjE0MThlMTlkZTBjY2UwOTA3Yjg0MDM2MzNfcFZESmJXMXRWSWl0b2M0aFgxZ3FTZWRRUTFTelJiTlJfVG9rZW46UUo0dGJmdmhHb1dsVDR4a3AwWGNYODBnbnRiXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)

### **协作流程**

用户输入自然语言任务（例如“今天是 2024-03-18，请写一篇关于过去一个月英伟达股价表现的博文”），自动构建助手解析任务，自动生成一组带有清晰角色定位和系统提示的agent（如金融分析师、数据分析师、内容写作者、编辑、数据抓取器），这相当于完成了第一层的任务分割。

随后，这些专家被放入一个新的GroupChat，并由GroupChatManager 管理对话推进，形成一个嵌套的群聊场景。在群聊中，Manager 根据前一轮消息的内容自动选择下一位发言者：先由写作者产出含占位符的草稿，从而显式暴露“数据获取”子任务；接着由数据抓取器提出可执行的代码；代码执行器运行代码并返回真实的收盘价、最高/最低价与涨跌幅；最后由编辑替换掉草稿中的占位符，润色形成完整的成稿并发送 TERMINATE 信号结束子群聊。子群聊结束后，summary_method 会对整个过程和结论进行反思式总结，这份总结作为最终的高层回答由 autobuild_assistant 发回给 user_proxy，从而实现了从自然语言需求输入，经由自动任务分割与多专家分工协作，到最终交付总结性回答的完整闭环流程。

## 2.4 Mixture of Agents

基于https://arxiv.org/abs/2406.04692以及消息的订阅和消费，模仿前馈神经网络架构。

### **框架角色**

**Orchestrator（协调者/调度器）**

- 接收用户输入任务。
    
- 负责把任务分派给多个工作代理（Workers），收集中间结果。
    
- 最终做结果聚合，输出给用户。
    

**Workers（执行代理）**

- 接收 Orchestrator 分派的子任务。
    
- 独立计算，给出答案。
    
- 不同 worker 可以在不同层，可能有冗余（多代理做相同任务以验证结果）或分工（不同代理做不同子任务）。
    

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=OTRjNTNkYmZlOWQzMGRkNjQ4YTQxOWVhM2ZmNGZhZDVfRFBqNjR1R3dlNEo1WlJ4MnVLTWZiOTc0WDI1alBIaXpfVG9rZW46T3V0Y2JRYjJYb0lPNWV4ZDN2WWNicnFhbkplXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)

### **协作流程**

**任务输入**：用户输入「432 个饼干，按 3:4:2 分给 Alice、Bob、Charlie」。

**任务分派**：Orchestrator 把任务发给 **layer 0 的多个 workers**。

**多代理计算**：layer 0 的 worker 各自完成计算，结果一致（Alice 144、Bob 192、Charlie 96）。

**结果汇总**：Orchestrator 收集 layer 0 结果，并将包含先前结果的更新任务分派给 **layer 1 的 workers** 做进一步验证或重算。

**二次验证**：layer 1 的 worker 同样独立输出结果。

**最终聚合**：Orchestrator 收集 layer 1 的输出，进行结果一致性检查，最终合并，输出统一答案。


## 2.5 Multi-Agent Debate

### **框架角色**

- **Aggregator (汇聚者)**
    
    - 接收用户任务（问题）。
        
    - 将任务广播给多个解题智能体 (Solvers)。
        
    - 收集多轮解答并做最终整合与裁决。
        
- **Solvers (解题代理)**
    
    - 独立尝试求解任务（例如：MathSolverA、B、C、D）。
        
    - 在每一轮中产出解答，并收到“邻居”代理的回应。
        
    - 可以对比他人解答，修正、重述或强化自己的推理。
        
    
    ![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=OWFiYWJmMWU3YzFlZjE0Y2VhNDFkZmRjYzNmZDE3MDBfRU5zcmNwaE5xVlFPeWpkNUtlQmlndVVNT0xiOFdXYmdfVG9rZW46VXhBWmJOekp5b2g4SHh4Z2hnRWN2a0IxbnRlXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)
    

### **协作流程**

1. **任务发布**
    
    1. Aggregator 收到用户问题。
        
    2. 将任务发送给所有 Solvers。
        
2. **初始解答（Round 0）**
    
    1. 每个 Solver 独立推理，输出一个答案。
        
    2. 同时带有推理过程。
        
3. **信息交换（Round 1 开始）**
    
    1. 每个 Solver 收到“邻居”们的答案。
        
    2. 进行对比与验证：
        
        - 如果一致 → 强化并重述结论。
            
        - 如果不同 → 触发讨论/辩驳，说明谁错谁对。
            
4. **多轮迭代（Round 1 → Round 2 → …）**
    
    1. Solvers 不断交换并调整。
        
    2. 在数学问题这种确定性场景下，几轮后都会收敛到同一结果。
        
5. **最终聚合**
    
    1. Aggregator 收集所有 Solvers 的最终答案。
        
    2. 根据一致性、多数投票或可信度加权来决定最终输出。
        
    3. 输出给用户。
        

# 3. LongManus

LangManus 是字节开源的多智能体自动化框架（通过LongGraph），核心思想是用**分层（hierarchical）多智能体架构**把复杂任务拆解给专长各异的角色，由上层“主管/协调者”进行流程编排与质控，底层“专家代理”具体执行（检索、浏览、写代码、生成报告等）。

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=M2ViOTkxM2QwM2Q3ZTc2ZTA0MjA0MjQxNWY2YzcyOTBfUGoyaThNNTBUa0ZYc2dHVVBqSVgyOWk5VVltVXFSUTBfVG9rZW46R3JJMGJkdkR0b1NvaFF4c3JPSWNqWkF5bmplXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)

  

# 4.横向对比

![](https://free4inno.feishu.cn/space/api/box/stream/download/asynccode/?code=NTA1OTdhZWQ0OTJmYTA5ZjU5Y2Q2Y2VlMjk4OWFlYWRfaUdqWTB5TFU5Uk9aNEFVaGliYjBkVDZyNEdJM0lLR1ZfVG9rZW46SWRuc2IwSExQb0FjeFp4enFvU2NKMUMybkpiXzE3NjAxNjUzNzk6MTc2MDE2ODk3OV9WNA)