<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>元芳接入MCP | 果冻小配方</title><meta name="author" content="GuoDong"><meta name="copyright" content="GuoDong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="项目特点(写在前面)基于 Flask + MySQL + ChromaDB 的 工具管理系统 ,部署在虎符上,为元芳mcp-client工具提供服务，主要用于管理和搜索各种元芳工具，并集成MCP,向量检索,内含元芳执行器不依赖其他元芳版本只依赖数据库。 返回接口执行失败 123456789&#123;    &quot;log&quot;: [        &#123;            &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="元芳接入MCP">
<meta property="og:url" content="https://gaoguodong03.github.io/gdBlog/2025/09/30/%E5%85%83%E8%8A%B3%E6%8E%A5%E5%85%A5MCP/index.html">
<meta property="og:site_name" content="果冻小配方">
<meta property="og:description" content="项目特点(写在前面)基于 Flask + MySQL + ChromaDB 的 工具管理系统 ,部署在虎符上,为元芳mcp-client工具提供服务，主要用于管理和搜索各种元芳工具，并集成MCP,向量检索,内含元芳执行器不依赖其他元芳版本只依赖数据库。 返回接口执行失败 123456789&#123;    &quot;log&quot;: [        &#123;            &amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gaoguodong03.github.io/gdBlog/img/touxiang.jpg">
<meta property="article:published_time" content="2025-09-29T16:00:00.000Z">
<meta property="article:modified_time" content="2025-09-30T10:02:07.164Z">
<meta property="article:author" content="GuoDong">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="元芳">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gaoguodong03.github.io/gdBlog/img/touxiang.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "元芳接入MCP",
  "url": "https://gaoguodong03.github.io/gdBlog/2025/09/30/%E5%85%83%E8%8A%B3%E6%8E%A5%E5%85%A5MCP/",
  "image": "https://gaoguodong03.github.io/gdBlog/img/touxiang.jpg",
  "datePublished": "2025-09-29T16:00:00.000Z",
  "dateModified": "2025-09-30T10:02:07.164Z",
  "author": [
    {
      "@type": "Person",
      "name": "GuoDong",
      "url": "https://gaoguodong03.github.io/gdBlog"
    }
  ]
}</script><link rel="shortcut icon" href="/gdBlog/img/logo.jpg"><link rel="canonical" href="https://gaoguodong03.github.io/gdBlog/2025/09/30/%E5%85%83%E8%8A%B3%E6%8E%A5%E5%85%A5MCP/index.html"><link rel="preconnect"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/gdBlog/css/index.css"><link rel="stylesheet" href="/gdBlog/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/gdBlog/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: '/gdBlog/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '元芳接入MCP',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.0.0"></head><body><div id="web_bg" style="background-image: url(/gdBlog/img/bg1.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/gdBlog/img/touxiang.jpg" onerror="this.onerror=null;this.src='/gdBlog/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/gdBlog/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/gdBlog/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/gdBlog/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/gdBlog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/gdBlog/"><img class="site-icon" src="/gdBlog/img/logo.jpg" alt="Logo"><span class="site-name">果冻小配方</span></a><a class="nav-page-title" href="/gdBlog/"><span class="site-name">元芳接入MCP</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/gdBlog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gdBlog/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">元芳接入MCP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-29T16:00:00.000Z" title="发表于 2025-09-30 00:00:00">2025-09-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-30T10:02:07.164Z" title="更新于 2025-09-30 18:02:07">2025-09-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/gdBlog/categories/%E6%9E%9C%E5%86%BB%E7%9A%84%E8%88%AA%E6%B5%B7%E6%97%A5%E5%BF%97/">果冻的航海日志</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="项目特点-写在前面"><a href="#项目特点-写在前面" class="headerlink" title="项目特点(写在前面)"></a>项目特点(写在前面)</h1><p>基于 Flask + MySQL + ChromaDB 的 工具管理系统 ,部署在虎符上,为元芳mcp-client工具提供服务，主要用于管理和搜索各种元芳工具，并集成MCP,向量检索,内含元芳执行器不依赖其他元芳版本只依赖数据库。</p>
<h2 id="返回接口"><a href="#返回接口" class="headerlink" title="返回接口"></a>返回接口</h2><p>执行失败</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;MCP_select_tool_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;工具名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;yf_tool_parameters&quot;</span><span class="punctuation">:</span> <span class="string">&quot;参数&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;错误信息或最终结果&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>执行成功</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;工具1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;描述1&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;工具2&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;描述2&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;工具3&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;描述3&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">	        <span class="attr">&quot;MCP_select_tool_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;实际选择的工具名&quot;</span><span class="punctuation">,</span> </span><br><span class="line">	        <span class="attr">&quot;yf_tool_parameters&quot;</span><span class="punctuation">:</span> <span class="string">&quot;具体参数&quot;</span></span><br><span class="line">	    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;response&quot;</span><span class="punctuation">:</span> <span class="string">&quot;工具执行的具体结果内容&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Flask应用</span><br><span class="line">├── CustomEmbeddingFunction (向量嵌入)</span><br><span class="line">├── Tool (数据模型)</span><br><span class="line">├── ToolCapability (工具管理)</span><br><span class="line">│   ├── search_Tool() 向量搜索</span><br><span class="line">│   └── get_tool() 工具详情</span><br><span class="line">└── API路由</span><br><span class="line">    ├── MCPClient (MCP集成)</span><br><span class="line">    └── DashScopeClient (大模型交互)</span><br></pre></td></tr></table></figure>
<h3 id="主要类描述"><a href="#主要类描述" class="headerlink" title="主要类描述"></a>主要类描述</h3><h4 id="1-CustomEmbeddingFunction-类-出问题找王闯师兄-我只调用API"><a href="#1-CustomEmbeddingFunction-类-出问题找王闯师兄-我只调用API" class="headerlink" title="1. CustomEmbeddingFunction 类(出问题找王闯师兄,我只调用API)"></a>1. CustomEmbeddingFunction 类(出问题找王闯师兄,我只调用API)</h4><ul>
<li>功能 : 处理向量嵌入请求</li>
<li>作用 : 向嵌入服务发送请求，将文本转换为向量表示</li>
<li>关键方法 : <strong>call</strong>() - 处理嵌入请求并返回向量</li>
</ul>
<h4 id="2-Tool-类（数据库模型）"><a href="#2-Tool-类（数据库模型）" class="headerlink" title="2. Tool 类（数据库模型）"></a>2. Tool 类（数据库模型）</h4><ul>
<li>功能 : 定义工具数据表结构</li>
<li>作用 : 映射MySQL数据库中的tools表</li>
<li>包含字段 : id、name、description、parameters、host、method、url等工具配置信息</li>
</ul>
<h4 id="3-ToolCapability-类-元芳执行器的调用方式-元芳能用该工具-我就能用"><a href="#3-ToolCapability-类-元芳执行器的调用方式-元芳能用该工具-我就能用" class="headerlink" title="3. ToolCapability 类(元芳执行器的调用方式,元芳能用该工具,我就能用)"></a>3. ToolCapability 类(元芳执行器的调用方式,元芳能用该工具,我就能用)</h4><ul>
<li>功能 : 工具能力管理核心类</li>
<li>作用 : 管理ChromaDB连接和工具搜索功能</li>
<li>关键方法 :<ul>
<li><strong>init</strong>() - 初始化数据库连接</li>
<li>search_Tool() - 基于任务描述搜索相关工具</li>
<li>get_tool() - 从数据库获取工具详情</li>
</ul>
</li>
</ul>
<h4 id="4-MCPClient-类（在api-clients-py中）"><a href="#4-MCPClient-类（在api-clients-py中）" class="headerlink" title="4. MCPClient 类（在api_clients.py中）"></a>4. MCPClient 类（在api_clients.py中）</h4><ul>
<li>功能 : MCP服务器客户端</li>
<li>作用 : 连接MCP服务器并处理工具调用</li>
<li>关键方法 : connect_to_server() , process_query()</li>
</ul>
<h4 id="5-DashScopeClient-类（在api-clients-py中）"><a href="#5-DashScopeClient-类（在api-clients-py中）" class="headerlink" title="5. DashScopeClient 类（在api_clients.py中）"></a>5. DashScopeClient 类（在api_clients.py中）</h4><ul>
<li>功能 : 通义千文API客户端</li>
<li>作用 : 与大模型进行对话交互</li>
<li>关键方法 : chat() - 发送聊天请求</li>
</ul>
<h2 id="以后的元芳工具描述格式"><a href="#以后的元芳工具描述格式" class="headerlink" title="以后的元芳工具描述格式"></a>以后的元芳工具描述格式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">名称:[MCP]_[核心动作][目标对象]</span><br><span class="line">描述:</span><br><span class="line">	功能说明：xxxxx</span><br><span class="line">	输入参数：</span><br><span class="line">	- xxx：xxxxxxx</span><br><span class="line">	适用场景：</span><br><span class="line">	- xxxxx</span><br><span class="line">	- xxxxx</span><br><span class="line">	- xxxxx</span><br><span class="line">例如:</span><br><span class="line">名称:[MCP]查询_虎符运行指标_Prometheus_服务</span><br><span class="line">描述:</span><br><span class="line">	功能说明：通过PromQL查询语句，获取获取虎符系统的各类运行指标数据。</span><br><span class="line">	输入参数：</span><br><span class="line">	- query：字符串，符合PromQL语法的Prometheus查询语句。</span><br><span class="line">	适用场景：</span><br><span class="line">	- 监控虎符系统运行状态</span><br><span class="line">	- 排查虎符服务异常</span><br><span class="line">	- 收集性能指标数据</span><br></pre></td></tr></table></figure>


<h3 id="工具的接入依靠"><a href="#工具的接入依靠" class="headerlink" title="工具的接入依靠"></a>工具的接入依靠</h3><p>1）先是向量检索工具数据库中的描述和名称字段，筛选出三个符合的描述；<br>2）将这三个工具开放的接口连同用户的提问直接交给大模型，大模型会自动填充和调用工具，工具执行过程使用的是另一份元芳执行器的执行代码</p>
<h2 id="Qwen的MCP格式"><a href="#Qwen的MCP格式" class="headerlink" title="Qwen的MCP格式"></a>Qwen的MCP格式</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">final_response</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;status_code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span>                    # HTTP状态码</span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Success&quot;</span><span class="punctuation">,</span>                     # 业务状态码</span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;success&quot;</span><span class="punctuation">,</span>                  # 业务消息</span><br><span class="line">    <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                           # 主要输出内容</span><br><span class="line">        <span class="attr">&quot;choices&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;模型生成的最终回答内容&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;usage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                            # 使用统计</span><br><span class="line">        <span class="attr">&quot;input_tokens&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;output_tokens&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total_tokens&quot;</span><span class="punctuation">:</span> <span class="number">150</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="项目意义"><a href="#项目意义" class="headerlink" title="项目意义"></a>项目意义</h1><p>由于MCP完美适配元芳的“应用-工具”模式, 如果使用MCP, 将不用在直接手动设定某个被调用的工具, MCP可以帮助我们选择工具, 并将参数自动填入, 最后将工具的结果变为自然语言, 我们就能很舒服的<strong>通过问问题而调用元芳的所有工具</strong>.</p>
<h1 id="项目来历"><a href="#项目来历" class="headerlink" title="项目来历"></a>项目来历</h1><p>2024年11月,MCP的诞生[[MCP]]<br>2025年4月,丁安然师姐<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Y1duYbEHo/?spm_id_from=333.1387.top_right_bar_window_custom_collection.content.click&vd_source=9465b0c882cf84738c83178da9a76207">介绍MCP专题</a><br>2025年5月,我开始尝试将MCP接入元芳,一开始使用OpenAI的模型,最后改为使用Qwen的模型<br>2025年7月,最后将元芳的工具描述补充完毕.<br>2025年9月,放完暑假,修改部分bug后, 最终将MCP上传Github<a target="_blank" rel="noopener" href="https://github.com/gaoguodong03/yuanfang-mcp">yuanfang-mcp</a></p>
<h2 id="项目进度"><a href="#项目进度" class="headerlink" title="项目进度"></a>项目进度</h2><p>一开始, 丁安然师姐在介绍MCP的时候直接通过API的调用接入了三个工具, 并手动添加了工具的描述,和元芳的关系不大, 只是作为演示.之后我便被徐老师安排将MCP接入元芳.</p>
<p>当时对元芳还不太熟悉,再加上代码能力不够,走了很多很多弯路, 写了很多垃圾代码. 最终确定了先画设计图,定义项目结构,最后再进行编程.<br>![[ObsidianPicture&#x2F;Pasted image 20250930180205.png]]</p>
<p>这里附上我写的流程图(其中的问题已经全部解决了,只用关心流程)</p>
<p>![[ObsidianPicture&#x2F;Pasted image 20250930180147.png]]<br>虽然,画了图,但是还是写了一坨屎山.主要原因还是不太熟悉元芳和虎符.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://gaoguodong03.github.io/gdBlog">GuoDong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://gaoguodong03.github.io/gdBlog/2025/09/30/%E5%85%83%E8%8A%B3%E6%8E%A5%E5%85%A5MCP/">https://gaoguodong03.github.io/gdBlog/2025/09/30/%E5%85%83%E8%8A%B3%E6%8E%A5%E5%85%A5MCP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://gaoguodong03.github.io/gdBlog" target="_blank">果冻小配方</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/gdBlog/tags/LLM/">LLM</a><a class="post-meta__tags" href="/gdBlog/tags/%E5%85%83%E8%8A%B3/">元芳</a></div><div class="post-share"><div class="social-share" data-image="/gdBlog/img/touxiang.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/gdBlog/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/gdBlog/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/gdBlog/2025/09/30/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">正则表达式</div></div><div class="info-2"><div class="info-item-1">高级版关键字搜索性能一般,但无所谓不差这点,功能强大,易于维护 字符集合g[ a o]t&#x3D;get or got[ a-z]就是a到z ; [^b-c ]除了b到c * 出现0或更多 {0}+  1 and more. {1}?  0 or 1            {0,1}{3} 3{3,}. 3 and more{3.6}  3 to 6 ^代表开始  $代表结束 </div></div></div></a><a class="pagination-related" href="/gdBlog/2025/09/30/MVC/" title="MVC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MVC</div></div><div class="info-2"><div class="info-item-1">简介MVC（Model-View-Controller，模型 - 视图 - 控制器）是一种软件架构设计模式，其核心思想是分离关注点，通过将应用程序划分为三个相互关联但功能独立的组件. 各组件的具体作用模型（Model）模型是应用程序的数据中心和业务逻辑核心，负责管理应用程序的数据和处理业务规则，是整个应用的 “大脑”。 主要职责：  存储和管理应用程序的数据（可以是数据库、内存数据结构等） 实现核心业务逻辑和数据处理规则 提供数据访问接口（供控制器调用） 当数据发生变化时，通知相关视图进行更新（观察者模式） 独立于视图和控制器，不关心数据如何展示和用户如何操作  视图（View）视图是应用程序的用户界面，负责数据的展示和用户交互的呈现，是用户能直接看到和操作的部分 主要职责：  从模型获取数据并以特定形式展示给用户（如网页、桌面窗口、移动端界面） 接收用户的界面操作（如点击按钮、输入文本等），但不处理这些操作的业务逻辑 不直接与模型交互，通过控制器获取需要展示的数据 一个模型可以对应多个视图（如同一组数据可以用表格、图表、列表等不同形式展示）  控制器（Controller）控制...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/gdBlog/2025/09/29/%E6%8E%A5%E5%85%A5Gemini%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="元芳接入Gemini大模型"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-29</div><div class="info-item-2">元芳接入Gemini大模型</div></div><div class="info-2"><div class="info-item-1">了解Geminigemini是google的 所以需要注册google对应的账号,由于需要翻墙再加上需要资金往来,所以放弃这条路了最后选择使用国内的代理网站 ,调用了一个 API 接口, 确实挺好用的 未完待续… </div></div></div></a><a class="pagination-related" href="/gdBlog/2025/09/30/MCP/" title="MCP(Model Context Protocol模型上下文协议)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-30</div><div class="info-item-2">MCP(Model Context Protocol模型上下文协议)</div></div><div class="info-2"><div class="info-item-1">MCP 起源于 2024 年 11 月 25 日, 定义了应用程序和 AI 模型之间交换上下文信息的方式。这使得开发者能够以一致的方式将各种数据源、工具和功能连接到 AI 模型（一个中间协议层），就像 USB-C 让不同设备能够通过相同的接口连接一样。MCP 的目标是创建一个通用标准，使 AI 应用程序的开发和集成变得更加简单和统一。 起源思考我认为 MCP 的出现是 prompt engineering 发展的产物。更结构化的上下文信息对模型的 performance 提升是显著的。在构造 prompt 时，希望能提供一些更 specific 的信息（比如本地文件，数据库，一些网络实时信息等）给模型，这样模型更容易理解真实场景中的问题。 第一阶段手工输入. 想象一下没有 MCP 之前我们会怎么做？我们可能会人工从数据库中筛选或者使用工具检索可能需要的信息，手动的粘贴到 prompt 中。随着我们要解决的问题越来越复杂，手工把信息引入到 prompt 中会变得越来越困难。 第二阶段 function call. 为了克服手工 prompt 的局限性，许多 LLM 平台（如 Ope...</div></div></div></a><a class="pagination-related" href="/gdBlog/2025/09/29/%E5%85%83%E8%8A%B3/" title="yuanfang"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-29</div><div class="info-item-2">yuanfang</div></div><div class="info-2"><div class="info-item-1">分为studio和chat,准确来说,就是只有studio,其中的一些功能可以发布在chat上,chat只是作为和chatGPT对应的一个页面,可以用来进一步的页面优化. 应用应用作为工作流式的智能体,可以展示具体的页面,通过子任务的顺序执行,并且可以通过前置代码和后置代码以及一些工具也能优化输出格式.可以选择变量的格式,包括codeVar变量,inputVar输入变量,singleSelect单选框,mutipulSeclect多选框还有下拉框.实现了工具的接口和应用的接口解耦合. 我实现的应用[[接入Gemini大模型]],输入具体的问题,调用Gemini工具,询问Gemini后返回回答[[元芳接入MCP]],根据自然语言输入,自动调用元芳工具中的工具,并将对应参数直接填入工具中 方法这方面好像是和方法论相关,主要作用应该是在”创建应用“时的智能创建使用的,,这里是添加一些专业知识,使得方法创建有一定依据.也就是和RAG相关,有时间可以问问潇龚师兄. 工具相当于一个个API接口,有固定的格式,修改url,head,body等,建议学习一下http的具体格式返回的时候返回所有的...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/gdBlog/img/touxiang.jpg" onerror="this.onerror=null;this.src='/gdBlog/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GuoDong</div><div class="author-info-description">碎碎念念 岁岁年年</div><div class="site-data"><a href="/gdBlog/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/gdBlog/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/gdBlog/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/gaoguodong03"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/gaoguodong03" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2987371922@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">有重要的事情 得去趟南京!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%89%B9%E7%82%B9-%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">项目特点(写在前面)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.1.</span> <span class="toc-text">返回接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E7%B1%BB%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">主要类描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-CustomEmbeddingFunction-%E7%B1%BB-%E5%87%BA%E9%97%AE%E9%A2%98%E6%89%BE%E7%8E%8B%E9%97%AF%E5%B8%88%E5%85%84-%E6%88%91%E5%8F%AA%E8%B0%83%E7%94%A8API"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">1. CustomEmbeddingFunction 类(出问题找王闯师兄,我只调用API)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Tool-%E7%B1%BB%EF%BC%88%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2. Tool 类（数据库模型）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-ToolCapability-%E7%B1%BB-%E5%85%83%E8%8A%B3%E6%89%A7%E8%A1%8C%E5%99%A8%E7%9A%84%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F-%E5%85%83%E8%8A%B3%E8%83%BD%E7%94%A8%E8%AF%A5%E5%B7%A5%E5%85%B7-%E6%88%91%E5%B0%B1%E8%83%BD%E7%94%A8"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">3. ToolCapability 类(元芳执行器的调用方式,元芳能用该工具,我就能用)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-MCPClient-%E7%B1%BB%EF%BC%88%E5%9C%A8api-clients-py%E4%B8%AD%EF%BC%89"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">4. MCPClient 类（在api_clients.py中）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-DashScopeClient-%E7%B1%BB%EF%BC%88%E5%9C%A8api-clients-py%E4%B8%AD%EF%BC%89"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">5. DashScopeClient 类（在api_clients.py中）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%90%8E%E7%9A%84%E5%85%83%E8%8A%B3%E5%B7%A5%E5%85%B7%E6%8F%8F%E8%BF%B0%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">以后的元芳工具描述格式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E7%9A%84%E6%8E%A5%E5%85%A5%E4%BE%9D%E9%9D%A0"><span class="toc-number">1.3.1.</span> <span class="toc-text">工具的接入依靠</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Qwen%E7%9A%84MCP%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">Qwen的MCP格式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%84%8F%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text">项目意义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%9D%A5%E5%8E%86"><span class="toc-number">3.</span> <span class="toc-text">项目来历</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%BF%9B%E5%BA%A6"><span class="toc-number">3.1.</span> <span class="toc-text">项目进度</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/gdBlog/2025/09/30/Docker/" title="Docker">Docker</a><time datetime="2025-09-29T16:00:00.000Z" title="发表于 2025-09-30 00:00:00">2025-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/gdBlog/2025/09/30/JSON/" title="JSON">JSON</a><time datetime="2025-09-29T16:00:00.000Z" title="发表于 2025-09-30 00:00:00">2025-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/gdBlog/2025/09/30/MCP/" title="MCP(Model Context Protocol模型上下文协议)">MCP(Model Context Protocol模型上下文协议)</a><time datetime="2025-09-29T16:00:00.000Z" title="发表于 2025-09-30 00:00:00">2025-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/gdBlog/2025/09/30/MVC/" title="MVC">MVC</a><time datetime="2025-09-29T16:00:00.000Z" title="发表于 2025-09-30 00:00:00">2025-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/gdBlog/2025/09/30/%E5%85%83%E8%8A%B3%E6%8E%A5%E5%85%A5MCP/" title="元芳接入MCP">元芳接入MCP</a><time datetime="2025-09-29T16:00:00.000Z" title="发表于 2025-09-30 00:00:00">2025-09-30</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div class="footer-other"><div class="footer-copyright"></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/gdBlog/js/utils.js"></script><script src="/gdBlog/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>